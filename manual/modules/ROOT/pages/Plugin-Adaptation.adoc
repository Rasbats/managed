= Adapting the legacy plugin

== Source Code Changes

Changes have been made to allow CI (Continuous Integration) as shown in Plugin Installer Code Adaptation.

== Replace/add files to enable CI (Continuous Integration)

Use the 
https://github.com/Rasbats/shipdriver_pi[ShipDriver
files/directories] 
as the source.

*Update-templates Script*

(Make a backup of _CMakeLists.txt_ for later use. It is overwritten by the script
)

This script has been written to simplify the process of adding the directories/files needed for the workflow.

You will need git bash for running the script. A guide is included in the ShipDriver repo: xref:UPDATE_TEMPLATES.adoc[UPDATE_TEMPLATES.md].

image:1files.jpg[1files.jpg]

== Using the script the following directories are copied from ShipDriver to the TideFinder directory:

* .circleci
* build-deps
* buildwin
* ci
* cmake
* flatpak (*rename org.opencpn.OpenCPN.Plugin.ShipDriver.yaml as
org.opencpn.OpenCPN.Plugin.TideFinder.yaml*)
* libs
* scripts

== This directory replaces the original in TideFinder:

* cmake

== These ShipDriver files are added to the TideFinder/ directory:

* .clang-format
* .cmake-format.yaml
* .drone.yml
* .gitattributes
* .gitignore
* .travis.yml
* appveyor.yml
* CMakeLists (Make a backup because the original will be overwritten)
* COPYING
* INSTALL.md
* plugin.xml.in
* UPDATE_TEMPLATES.md
* update-templates

=== Files to edit

* README.md
* CMakeLists.txt
* flatpak/org.opencpn.OpenCPN.Plugin.TideFinder.yaml

It may be easiest to use two text editor windows, one showing the
TideFinder file with the other showing the ShipDriver file.

== README.md

Change the building instructions and make other edits as necessary.

== CMakeLists.txt

The legacy _CMakeLists.txt_ has been replaced by a generic file, which is the one copied from ShipDriver and a further cmake file: _Plugin.cmake_. This file contains a list of the source code files and other data specific to the plugin.

Open the legacy _CMakeLists.txt_ backup file for reference.
Copy the ShipDriver _Plugin.cmake_ file to the main directory of your plugin. Edit the _Plugin.cmake_ file substituting TideFinder for ShipDriver. 

Remove _src/ocpn_plugin.h_ from the source files listed in _Plugin.cmake_. This is now found in the libs/api-16 directory. The file can also be removed from the source directory.

== org.opencpn.OpenCPN.Plugin.TideFinder.yaml

This file is found in the _flatpak_ directory. Just 3 name
substitutions, tidefinder replacing shipdriver.

xref:Overview.adoc[The Shipdriver Workflow]
